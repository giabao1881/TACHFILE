<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF Tool Kit - T·∫°o b·ªüi baotg10</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #2563eb;
      --bg-body: #f1f5f9;
      --bg-card: #ffffff;
      --text-main: #1e293b;
      --border: #e2e8f0;
      --radius: 12px;
    }

    * { box-sizing: border-box; }
    body { margin: 0; padding: 20px; font-family: 'Inter', sans-serif; background: var(--bg-body); color: var(--text-main); }
    .container { max-width: 900px; margin: 0 auto; }
    
    /* BRANDING HEADER */
    .header { text-align: center; margin-bottom: 25px; }
    .header h1 { margin: 0; font-size: 26px; color: #0f172a; font-weight: 800; }
    .header .subtitle { color: var(--primary); font-weight: 600; margin-top: 5px; font-size: 15px; }
    
    .nav-main { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; flex-wrap: wrap;}
    .nav-btn { border: none; background: #e2e8f0; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; color: #64748b; transition:.2s; }
    .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3); }

    .card { background: var(--bg-card); border-radius: var(--radius); box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid var(--border); margin-bottom: 15px; padding: 20px; }
    .step-badge { background: #3b82f6; color: white; width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 13px; margin-right: 8px; font-weight: bold; }
    .card h3 { margin-top: 0; font-size: 16px; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; display: flex; align-items: center;}

    /* Drop Zone */
    .drop-zone { border: 2px dashed #94a3b8; border-radius: var(--radius); padding: 30px; text-align: center; cursor: pointer; background: #f8fafc; transition: .2s; display: block; }
    .drop-zone:hover, .drop-zone.dragover { border-color: var(--primary); background: #eff6ff; transform: scale(1.005); }
    
    .form-group { margin-bottom: 15px; }
    label { display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px; color: #334155; }
    input[type="text"], input[type="number"], textarea, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-family: inherit; font-size: 14px; }
    
    .btn-action { width: 100%; background: var(--primary); color: white; border: none; padding: 14px; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 16px; transition: .2s; box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.4); }
    .btn-action:hover { background: #1d4ed8; transform: translateY(-1px); }
    .btn-action:disabled { background: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }

    /* Tabs Split */
    .tabs { display: flex; background: #e2e8f0; padding: 4px; border-radius: 10px; margin-bottom: 20px; }
    .tab-item { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 8px; font-size: 14px; font-weight: 500; color: #64748b; transition: .2s; }
    .tab-item.active { background: white; color: var(--primary); font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

    .hidden { display: none !important; }
    
    /* Guide Box Styles - L√†m h∆∞·ªõng d·∫´n d·ªÖ hi·ªÉu h∆°n */
    .guide-box {
      background: #eff6ff; border-left: 4px solid var(--primary);
      padding: 12px; margin-bottom: 15px; border-radius: 4px;
      font-size: 13.5px; line-height: 1.5; color: #1e3a8a;
    }
    .guide-title { font-weight: 700; display: block; margin-bottom: 4px; color: #172554; }
    .guide-example { background: rgba(255,255,255,0.7); padding: 4px 8px; border-radius: 4px; border: 1px solid #bfdbfe; font-family: monospace; font-weight: bold; color: #d946ef; }

    .log-area { background: #0f172a; color: #e2e8f0; padding: 12px; border-radius: 8px; height: 120px; overflow-y: auto; font-family: monospace; font-size: 12px; margin-top: 10px; }
    .file-tag { display: inline-block; background: #f1f5f9; padding: 4px 10px; border-radius: 4px; font-size: 13px; margin: 4px 0; border: 1px solid #cbd5e1; width: 100%; display: flex; justify-content: space-between; }
    
    .footer-brand { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0; color: #64748b; font-size: 13px; }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>PDF TOOL KIT V5</h1>
    <div class="subtitle">‚ú® Ph√°t tri·ªÉn b·ªüi baotg10 ‚ú®</div>
  </div>

  <div class="nav-main">
    <button class="nav-btn active" onclick="setApp('split')">‚úÇÔ∏è T√°ch File</button>
    <button class="nav-btn" onclick="setApp('merge')">üîó G·ªôp File</button>
    <button class="nav-btn" onclick="setApp('compress')">üóúÔ∏è N√©n (Gi·∫£m MB)</button>
  </div>

  <div id="app-split">
    <div class="card">
      <h3><span class="step-badge">1</span> Ch·ªçn File PDF G·ªëc</h3>
      <label class="drop-zone" id="dropSplit">
        <input type="file" id="fileSplit" accept="application/pdf" hidden>
        <div style="font-size: 32px;">üìÇ</div>
        <div><b>B·∫•m v√†o ƒë√¢y</b> ƒë·ªÉ ch·ªçn file ho·∫∑c K√©o th·∫£ file v√†o</div>
        <div id="splitInfo" style="color:var(--primary); font-weight:bold; margin-top:8px"></div>
      </label>
    </div>
    
    <div class="card">
      <h3><span class="step-badge">2</span> Ch·ªçn Ki·ªÉu T√°ch (ƒê·ªçc k·ªπ h∆∞·ªõng d·∫´n)</h3>
      <div class="tabs">
        <div class="tab-item active" onclick="setSplitMode('single', this)">1. T√°ch R·ªùi (T·ª´ng trang)</div>
        <div class="tab-item" onclick="setSplitMode('custom', this)">2. T√°ch Nh√≥m (Tu·ª≥ ch·ªçn)</div>
        <div class="tab-item" onclick="setSplitMode('size', this)">3. T√°ch Theo Dung L∆∞·ª£ng</div>
      </div>

      <div id="mode-single">
        <div class="guide-box">
          <span class="guide-title">üí° Gi·∫£i th√≠ch:</span>
          Ch·∫ø ƒë·ªô n√†y s·∫Ω c·∫Øt nh·ªè to√†n b·ªô file g·ªëc. File g·ªëc c√≥ 100 trang s·∫Ω ra 100 file PDF nh·ªè.<br>
          <i>Ph√π h·ª£p khi b·∫°n mu·ªën l·∫•y ri√™ng l·∫ª t·ª´ng t·ªù m·ªôt.</i>
        </div>
        <label>Danh s√°ch t√™n file m·ªõi (Kh√¥ng b·∫Øt bu·ªôc):</label>
        <textarea id="splitNames" placeholder="D√°n danh s√°ch t√™n v√†o ƒë√¢y... D√≤ng 1 ƒë·∫∑t cho trang 1, D√≤ng 2 cho trang 2..."></textarea>
      </div>

      <div id="mode-custom" class="hidden">
        <div class="guide-box">
          <span class="guide-title">üí° H∆∞·ªõng d·∫´n nh·∫≠p c√¥ng th·ª©c:</span>
          D√πng d·∫•u g·∫°ch ƒë·ª©ng <span class="guide-example">|</span> ƒë·ªÉ chia file.<br>
          D√πng d·∫•u g·∫°ch ngang <span class="guide-example">-</span> ƒë·ªÉ l·∫•y kho·∫£ng trang.<br><br>
          <b>V√≠ d·ª•:</b> B·∫°n mu·ªën t√°ch l√†m 3 file:<br>
          ‚Ä¢ File 1: L·∫•y t·ª´ trang 1 ƒë·∫øn 5<br>
          ‚Ä¢ File 2: Ch·ªâ l·∫•y trang 8<br>
          ‚Ä¢ File 3: L·∫•y t·ª´ trang 10 ƒë·∫øn 12<br>
          üëâ <b>Nh·∫≠p v√†o √¥ d∆∞·ªõi:</b> <span class="guide-example">1-5 | 8 | 10-12</span>
        </div>
        <label>Nh·∫≠p trang c·∫ßn t√°ch:</label>
        <input type="text" id="customRange" placeholder="VD: 1-5 | 8 | 10-12">
        <label style="margin-top:15px">ƒê·∫∑t t√™n cho t·ª´ng nh√≥m (M·ªói d√≤ng 1 t√™n):</label>
        <textarea id="customNames" placeholder="T√™n cho nh√≥m 1...&#10;T√™n cho nh√≥m 2..."></textarea>
      </div>

      <div id="mode-size" class="hidden">
        <div class="guide-box">
          <span class="guide-title">üí° Gi·∫£i th√≠ch:</span>
          D√πng khi file qu√° n·∫∑ng kh√¥ng g·ª≠i Zalo/Email ƒë∆∞·ª£c. Tool s·∫Ω t·ª± ƒë·ªông gom c√°c trang l·∫°i, khi n√†o <b>g·∫ßn ƒë·ªß dung l∆∞·ª£ng</b> b·∫°n c√†i ƒë·∫∑t (v√≠ d·ª• 5MB) th√¨ n√≥ s·∫Ω c·∫Øt sang file m·ªõi.
        </div>
        <label>Gi·ªõi h·∫°n dung l∆∞·ª£ng m·ªói file (MB):</label>
        <input type="number" id="splitMaxMB" value="5" style="font-weight:bold; color:var(--primary)">
      </div>
    </div>

    <button id="btnSplit" class="btn-action" disabled>üöÄ T√°ch File Ngay</button>
  </div>

  <div id="app-merge" class="hidden">
    <div class="card">
      <h3><span class="step-badge">1</span> Ch·ªçn File C·∫ßn G·ªôp</h3>
      <label class="drop-zone" id="dropMerge">
        <input type="file" id="fileMerge" accept="application/pdf" multiple hidden>
        <div style="font-size: 32px;">üìö</div>
        <div>Ch·ªçn nhi·ªÅu file c√πng l√∫c ho·∫∑c K√©o th·∫£ v√†o</div>
      </label>
      <div id="mergeList" style="margin-top:15px"></div>
    </div>
    <div class="card">
      <h3><span class="step-badge">2</span> L∆∞u File</h3>
      <label>ƒê·∫∑t t√™n file k·∫øt qu·∫£:</label>
      <input type="text" id="mergeName" value="File_Da_Gop_baotg10.pdf">
    </div>
    <button id="btnMerge" class="btn-action" disabled>üîó G·ªôp File Ngay</button>
  </div>

  <div id="app-compress" class="hidden">
    <div class="card">
      <h3><span class="step-badge">1</span> Ch·ªçn File C·∫ßn N√©n</h3>
      <label class="drop-zone" id="dropCompress">
        <input type="file" id="fileCompress" accept="application/pdf" hidden>
        <div style="font-size: 32px;">üóúÔ∏è</div>
        <div>Ch·ªçn file PDF dung l∆∞·ª£ng l·ªõn</div>
        <div id="compressInfo" style="color:var(--primary); font-weight:bold; margin-top:8px"></div>
      </label>
    </div>
    
    <div class="card">
      <h3><span class="step-badge">2</span> Ch·ªçn M·ª©c ƒê·ªô N√©n</h3>
      <div class="guide-box" style="background:#fff7ed; border-color:#f97316; color:#c2410c">
        ‚ö†Ô∏è <b>L∆∞u √Ω quan tr·ªçng:</b> Ch·ª©c nƒÉng n√†y s·∫Ω chuy·ªÉn ƒë·ªïi PDF th√†nh d·∫°ng ·∫¢nh ƒë·ªÉ gi·∫£m dung l∆∞·ª£ng t·ªëi ƒëa. File sau khi n√©n s·∫Ω <b>kh√¥ng th·ªÉ copy ch·ªØ</b> ƒë∆∞·ª£c n·ªØa.
      </div>
      <label>Ch·∫•t l∆∞·ª£ng ƒë·∫ßu ra:</label>
      <select id="compressQuality">
        <option value="0.4">N√©n M·∫°nh (File r·∫•t nh·∫π - ·∫¢nh m·ªù)</option>
        <option value="0.6" selected>N√©n V·ª´a (Khuy√™n d√πng)</option>
        <option value="0.8">N√©n √çt (File n√©t - Gi·∫£m √≠t)</option>
      </select>
    </div>
    <button id="btnCompress" class="btn-action" disabled>üìâ B·∫Øt ƒë·∫ßu N√©n</button>
  </div>

  <div class="log-area" id="logBox">S·∫µn s√†ng...</div>
  
  <div class="footer-brand">
    ¬© 2024 B·∫£n quy·ªÅn c√¥ng c·ª• thu·ªôc v·ªÅ <b>baotg10</b>.<br>
    Vui l√≤ng ghi r√µ ngu·ªìn n·∫øu chia s·∫ª.
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

<script>
  // C·∫•u h√¨nh Worker cho PDF.js
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

  // --- GLOBAL VARIABLES ---
  const $ = (id) => document.getElementById(id);
  const logBox = $('logBox');
  function log(m) { logBox.innerHTML += `<div>> ${m}</div>`; logBox.scrollTop = logBox.scrollHeight; }

  // CH·∫∂N K√âO TH·∫¢ M·ªû FILE
  window.addEventListener("dragover", e => e.preventDefault());
  window.addEventListener("drop", e => e.preventDefault());

  // --- NAVIGATION ---
  function setApp(app) {
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    ['split','merge','compress'].forEach(k => $(`app-${k}`).classList.add('hidden'));
    $(`app-${app}`).classList.remove('hidden');
  }

  function setupDrop(id, cb) {
    const el = $(id);
    el.addEventListener('dragenter', ()=>el.classList.add('dragover'));
    el.addEventListener('dragleave', ()=>el.classList.remove('dragover'));
    el.addEventListener('drop', (e)=>{
      el.classList.remove('dragover');
      if(e.dataTransfer.files.length) cb(e.dataTransfer.files);
    });
    el.querySelector('input').addEventListener('change', function(){
      if(this.files.length) cb(this.files);
    });
  }

  function save(blob, name) {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = name;
    a.click();
  }

  // ================= 1. LOGIC T√ÅCH (SPLIT) =================
  let splitBytes=null, splitName='', splitMode='single';

  setupDrop('dropSplit', async (files)=>{
    const f = files[0];
    if(f.type!=='application/pdf') return alert('Vui l√≤ng ch·ªçn file PDF!');
    splitBytes = await f.arrayBuffer();
    splitName = f.name.replace('.pdf','');
    $('splitInfo').textContent = `‚úÖ ƒê√£ ch·ªçn: ${f.name} (${(f.size/1e6).toFixed(2)} MB)`;
    $('btnSplit').disabled=false;
    log(`ƒê√£ n·∫°p file: ${f.name}`);
  });

  window.setSplitMode = (m, el) => {
    splitMode = m;
    document.querySelectorAll('.tab-item').forEach(i=>i.classList.remove('active'));
    el.classList.add('active');
    ['single','custom','size'].forEach(x=>$(`mode-${x}`).classList.add('hidden'));
    $(`mode-${m}`).classList.remove('hidden');
  }

  $('btnSplit').addEventListener('click', async ()=>{
    if(!splitBytes) return;
    const btn = $('btnSplit'); btn.disabled=true; btn.innerText="‚è≥ ƒêang x·ª≠ l√Ω...";
    try {
      const pdfDoc = await PDFLib.PDFDocument.load(splitBytes);
      const total = pdfDoc.getPageCount();
      const zip = new JSZip();
      let groups = [];
      
      if(splitMode==='single') {
        for(let i=0; i<total; i++) groups.push([i]);
      } else if(splitMode==='custom') {
        const parts = $('customRange').value.split('|');
        parts.forEach(p => {
          let g = [];
          p.split(',').forEach(s => {
            if(s.includes('-')) {
              let [a,b] = s.split('-').map(Number);
              for(let k=a; k<=b; k++) if(k<=total) g.push(k-1);
            } else {
              let n=Number(s); if(n<=total) g.push(n-1);
            }
          });
          if(g.length) groups.push(g);
        });
      } else {
        log('ƒêang t√≠nh to√°n dung l∆∞·ª£ng...');
        const max = $('splitMaxMB').value * 1024 * 1024;
        let curG=[], curS=0;
        for(let i=0; i<total; i++) {
          const t = await PDFLib.PDFDocument.create();
          const [cp] = await t.copyPages(pdfDoc,[i]);
          t.addPage(cp);
          const b = await t.save();
          if(curG.length && (curS+b.length > max)) { groups.push(curG); curG=[]; curS=0; }
          curG.push(i); curS+=b.length;
        }
        if(curG.length) groups.push(curG);
      }

      const names = (splitMode==='single' ? $('splitNames').value : $('customNames').value).split('\n');
      for(let i=0; i<groups.length; i++){
        const newPdf = await PDFLib.PDFDocument.create();
        const cp = await newPdf.copyPages(pdfDoc, groups[i]);
        cp.forEach(p=>newPdf.addPage(p));
        const b = await newPdf.save();
        let fn = names[i]?.trim() || `${splitName}_Part_${i+1}`;
        fn = fn.replace(/[\\/:*?"<>|]/g, "_");
        zip.file(`${fn}.pdf`, b);
      }
      const z = await zip.generateAsync({type:'blob'});
      save(z, `${splitName}_Split_by_baotg10.zip`);
      log('‚úÖ T√°ch th√†nh c√¥ng! ƒêang t·∫£i xu·ªëng...');
    } catch(e) { log('‚ùå L·ªói: '+e.message); alert('Ki·ªÉm tra l·∫°i c√¥ng th·ª©c nh·∫≠p!'); }
    btn.disabled=false; btn.innerText="üöÄ T√°ch File Ngay";
  });

  // ================= 2. LOGIC G·ªòP (MERGE) =================
  let mergeFiles=[];
  setupDrop('dropMerge', async (files)=>{
    for(let f of files) {
      if(f.type==='application/pdf') mergeFiles.push({name:f.name, data:await f.arrayBuffer()});
    }
    renderMerge();
  });
  function renderMerge(){
    $('mergeList').innerHTML = mergeFiles.map((f,i)=>`
      <div class="file-tag">
        <span>${i+1}. ${f.name}</span>
        <span style="color:red;cursor:pointer;font-weight:bold" onclick="delMerge(${i})">‚úï Xo√°</span>
      </div>`).join('');
    $('btnMerge').disabled = mergeFiles.length<2;
  }
  window.delMerge = (i) => { mergeFiles.splice(i,1); renderMerge(); }

  $('btnMerge').addEventListener('click', async ()=>{
    const btn = $('btnMerge'); btn.disabled=true; btn.innerText="‚è≥ ƒêang g·ªôp...";
    try {
      const doc = await PDFLib.PDFDocument.create();
      for(let f of mergeFiles){
        const s = await PDFLib.PDFDocument.load(f.data);
        const cp = await doc.copyPages(s, s.getPageIndices());
        cp.forEach(p=>doc.addPage(p));
      }
      save(new Blob([await doc.save()],{type:'application/pdf'}), $('mergeName').value);
      log('‚úÖ G·ªôp th√†nh c√¥ng!');
    } catch(e){ log('‚ùå L·ªói: '+e.message); }
    btn.disabled=false; btn.innerText="üîó G·ªôp File Ngay";
  });

  // ================= 3. LOGIC N√âN (COMPRESS) =================
  let compressBytes=null, compressName='';
  setupDrop('dropCompress', async (files)=>{
    const f = files[0];
    if(f.type!=='application/pdf') return alert('Ch·ªâ h·ªó tr·ª£ PDF!');
    compressBytes = await f.arrayBuffer();
    compressName = f.name;
    $('compressInfo').textContent = `‚úÖ File: ${f.name} (${(f.size/1e6).toFixed(2)} MB)`;
    $('btnCompress').disabled=false;
    log(`ƒê√£ n·∫°p file n√©n: ${f.name}`);
  });

  $('btnCompress').addEventListener('click', async ()=>{
    if(!compressBytes) return;
    const btn = $('btnCompress'); btn.disabled=true; btn.innerText="‚è≥ ƒêang x·ª≠ l√Ω (S·∫Ω h∆°i l√¢u)...";
    
    try {
      const quality = parseFloat($('compressQuality').value);
      const loadingTask = pdfjsLib.getDocument(compressBytes);
      const pdf = await loadingTask.promise;
      const total = pdf.numPages;
      const newPdf = await PDFLib.PDFDocument.create();

      for (let i = 1; i <= total; i++) {
        log(`ƒêang n√©n trang ${i}/${total}...`);
        const page = await pdf.getPage(i);
        const viewport = page.getViewport({ scale: 1.5 });
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        await page.render({ canvasContext: ctx, viewport: viewport }).promise;
        const imgDataUrl = canvas.toDataURL('image/jpeg', quality);
        const imgBytes = await fetch(imgDataUrl).then(res => res.arrayBuffer());

        const embeddedImg = await newPdf.embedJpg(imgBytes);
        const newPage = newPdf.addPage([viewport.width, viewport.height]);
        newPage.drawImage(embeddedImg, { x: 0, y: 0, width: viewport.width, height: viewport.height });
      }

      const resultBytes = await newPdf.save();
      save(new Blob([resultBytes], {type: 'application/pdf'}), `Compressed_${compressName}`);
      log(`‚úÖ N√©n xong! ƒêang t·∫£i xu·ªëng.`);
    } catch (e) {
      log('‚ùå L·ªói n√©n: ' + e.message); console.error(e);
    }
    btn.disabled = false; btn.innerText="üìâ B·∫Øt ƒë·∫ßu N√©n";
  });
</script>
</body>
</html>
